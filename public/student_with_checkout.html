<!DOCTYPE html>
<html>
<head>
<title>MCQ Unlock Test</title>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body style="background:#000;color:#fff;">
<h1>Pay to Unlock MCQs</h1>
<button id="payBtn">Pay ₹1 (test)</button>
<script>
const KEY = "TO_PACKAGE_A_ACCESS";
function mark(days){ localStorage.setItem(KEY, String(Date.now()+days*24*60*60*1000)); }
function isPaid(){ const t=parseInt(localStorage.getItem(KEY)||'0',10); return t && Date.now()<t; }

document.getElementById('payBtn').onclick = async function(){
  try{
    const amount = 100; // ₹1
    const resp = await fetch('/api/create-order', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ amount, currency:'INR', notes:{ planDays:30 } })
    }).then(r=>r.json());
    if(!resp.ok) throw new Error(resp.error||'order failed');
    const { id: order_id } = resp.order;

    const rzp = new Razorpay({
      key: 'rzp_test_xxxxxxxxxxxx', 
      amount, currency:'INR', order_id,
      name: 'TO • Payment', description: 'Unlock MCQs',
      handler: async function (response){
        const v = await fetch('/api/verify', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify(response)
        }).then(r=>r.json());
        if(!v.ok) return alert('Verify failed: '+(v.error||''));
        mark(v.unlockDays || 30);
        alert('Payment verified ✓ — MCQs unlocked');
      }
    });
    rzp.open();
  }catch(e){ alert(e.message||e); }
};
</script>
</body>
</html>